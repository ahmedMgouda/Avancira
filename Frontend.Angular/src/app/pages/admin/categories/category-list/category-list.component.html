<div class="container">

  <!-- Test Loading Button -->
  <button
    class="btn btn-secondary"
    [appLoading]="isRefresh()"
    loadingColor="#1E88E5"
    loadingSize="small"
    loadingPosition="right"
    (click)="testLoading()">
    Test Loading
  </button>

  <!-- Header -->
  <div class="header">
    <h1>Categories</h1>
    <div class="header-actions">
      <button 
        class="btn btn-secondary" 
        (click)="refreshList()"
        [disabled]="loading()"
        title="Refresh list">
        <span class="icon">‚Üª</span>
        Refresh
      </button>
      <button class="btn btn-primary" (click)="onCreate()">
        <span class="icon">+</span>
        Create Category
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="Search categories..."
        [value]="searchTerm()"
        (input)="onSearchInput($any($event.target).value)"
        class="search-input"
        [disabled]="loading()"
      />
    </div>

    <div class="filters">
      <div class="filter-group">
        <label>Status:</label>
        <select
          title="Filter by status"
          aria-label="Status filter"
          [value]="filterActive() === undefined ? '' : filterActive() ? 'true' : 'false'"
          (change)="onFilterChange('active', $any($event.target).value)"
          class="filter-select"
          [disabled]="loading()"
        >
          <option value="">All</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Visibility:</label>
        <select
          title="Filter by visibility"
          aria-label="Visibility filter"
          [value]="filterVisible() === undefined ? '' : filterVisible() ? 'true' : 'false'"
          (change)="onFilterChange('visible', $any($event.target).value)"
          class="filter-select"
          [disabled]="loading()"
        >
          <option value="">All</option>
          <option value="true">Visible</option>
          <option value="false">Hidden</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Featured:</label>
        <select
          title="Filter by Featured"
          aria-label="Featured filter"
          [value]="filterFeatured() === undefined ? '' : filterFeatured() ? 'true' : 'false'"
          (change)="onFilterChange('featured', $any($event.target).value)"
          class="filter-select"
          [disabled]="loading()"
        >
          <option value="">All</option>
          <option value="true">Featured</option>
          <option value="false">Not Featured</option>
        </select>
      </div>

      @if (hasActiveFilters()) {
        <button 
          class="btn btn-secondary" 
          (click)="clearFilters()"
          [disabled]="loading()">
          Clear Filters
        </button>
      }
    </div>
  </div>

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error">
      <strong>Error:</strong> {{ error() }}
    </div>
  }

  <!-- Results Section -->
   <div  [appLoading]="loading()"
        loadingSize="medium" loadingDisplay="inline" >
<div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th (click)="onSort('name')" class="sortable">
            Name {{ getSortIcon('name') }}
          </th>
          <th>Description</th>
          <th (click)="onSort('sortOrder')" class="sortable text-center">
            Sort Order {{ getSortIcon('sortOrder') }}
          </th>
          <th (click)="onSort('isActive')" class="sortable text-center">
            Active {{ getSortIcon('isActive') }}
          </th>
          <th (click)="onSort('isVisible')" class="sortable text-center">
            Visible {{ getSortIcon('isVisible') }}
          </th>
          <th (click)="onSort('isFeatured')" class="sortable text-center">
            Featured {{ getSortIcon('isFeatured') }}
          </th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>

      <!-- üëá Skeleton loader applied here -->
      <tbody>
        @if (!loading()) {
          @if (showEmptyState()) {
            <tr>
              <td colspan="7" class="text-center empty-state">
                <div class="empty-state-content">
                  <p class="empty-state-icon">üìÅ</p>
                  <p class="empty-state-message">
                    @if (hasActiveFilters()) {
                      No categories match your filters.
                    } @else {
                      No categories found.
                    }
                  </p>
                  @if (hasActiveFilters()) {
                    <button class="btn btn-secondary" (click)="clearFilters()">
                      Clear Filters
                    </button>
                  } @else {
                    <button class="btn btn-primary" (click)="onCreate()">
                      <span class="icon">+</span>
                      Create Your First Category
                    </button>
                  }
                </div>
              </td>
            </tr>
          } @else {
            @for (category of categories(); track trackByCategory($index, category)) {
              <tr [class.deleting]="isDeleting(category.id)">
                <td class="category-name"><strong>{{ category.name }}</strong></td>
                <td class="description">{{ category.description || '‚Äî' }}</td>
                <td class="text-center"><span class="sort-order-badge">{{ category.sortOrder }}</span></td>
                <td class="text-center">
                  <span [class]="'badge ' + (category.isActive ? 'badge-success' : 'badge-danger')">
                    {{ category.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td class="text-center">
                  <span [class]="'badge ' + (category.isVisible ? 'badge-success' : 'badge-secondary')">
                    {{ category.isVisible ? 'Visible' : 'Hidden' }}
                  </span>
                </td>
                <td class="text-center">
                  @if (category.isFeatured) {
                    <span class="badge badge-warning">‚òÖ Featured</span>
                  } @else {
                    <span class="badge badge-secondary">‚Äî</span>
                  }
                </td>
                <td class="actions">
                  <button class="btn btn-sm btn-info" title="View Details" (click)="onView(category.id)" [disabled]="isDeleting(category.id)">üëÅ</button>
                  <button class="btn btn-sm btn-primary" title="Edit" (click)="onEdit(category.id)" [disabled]="isDeleting(category.id)">‚úèÔ∏è</button>
                  <button class="btn btn-sm btn-danger" title="Delete" (click)="onDelete(category)" [disabled]="isDeleting(category.id)">
                    @if (isDeleting(category.id)) {
                      <span class="spinner-small"></span>
                    } @else {
                      üóëÔ∏è
                    }
                  </button>
                </td>
              </tr>
            }
          }
        }
      </tbody>
    </table>
  </div>
   </div>
  

  <!-- Pagination -->
  @if (hasResults() && totalPages() > 1) {
    <div class="pagination-container">
      <div class="pagination-info">
        <label for="pageSize">Items per page:</label>
        <select
          id="pageSize"
          [value]="pageSize()"
          (change)="onPageSizeChange(+$any($event.target).value)"
          class="page-size-select">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>

      <div class="pagination">
        <button class="btn btn-sm btn-secondary" (click)="onFirstPage()" [disabled]="currentPage() === 1">¬´</button>
        <button class="btn btn-sm btn-secondary" (click)="onPreviousPage()" [disabled]="currentPage() === 1">‚Äπ</button>

        @for (page of visiblePages(); track page) {
          @if (page === '...') {
            <span class="pagination-ellipsis">...</span>
          } @else {
            <button
              class="btn btn-sm"
              [class.btn-primary]="page === currentPage()"
              [class.btn-secondary]="page !== currentPage()"
              (click)="onPageChange(page)"
              [disabled]="page === currentPage()">
              {{ page }}
            </button>
          }
        }

        <button class="btn btn-sm btn-secondary" (click)="onNextPage()" [disabled]="currentPage() === totalPages()">‚Ä∫</button>
        <button class="btn btn-sm btn-secondary" (click)="onLastPage()" [disabled]="currentPage() === totalPages()">¬ª</button>
      </div>

      <div class="pagination-summary">
        Page {{ currentPage() }} of {{ totalPages() }}
      </div>
    </div>
  }
</div>
