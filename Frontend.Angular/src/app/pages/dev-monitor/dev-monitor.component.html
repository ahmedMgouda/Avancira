<div class="dev-monitor">
  <!-- HEADER -->
  <div class="monitor-header">
    <h1>
      <span class="icon">üß©</span>
      Development Monitor
    </h1>

    <div class="header-actions">
      <button (click)="togglePause()" [class.active]="isPaused()">
        {{ isPaused() ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause' }}
      </button>
      <button (click)="clearLogs()">üóëÔ∏è Clear</button>
      <button (click)="exportLogs()">üíæ Export</button>
    </div>
  </div>

  <!-- METRICS -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-label">Total Logs</div>
      <div class="metric-value">{{ metrics().totalLogs }}</div>
    </div>
    <div class="metric-card error">
      <div class="metric-label">Errors</div>
      <div class="metric-value">{{ metrics().totalErrors }}</div>
    </div>
    <div class="metric-card warning">
      <div class="metric-label">Warnings</div>
      <div class="metric-value">{{ metrics().totalWarnings }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">HTTP Requests</div>
      <div class="metric-value">{{ metrics().httpRequests }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Slow Requests</div>
      <div class="metric-value">{{ metrics().slowRequests }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Error Rate</div>
      <div class="metric-value">{{ metrics().errorRate }}</div>
    </div>
  </div>

  <!-- LEVEL STATS -->
  <div class="level-stats">
    @for (level of availableLevels(); track level) {
      <button
        class="level-badge"
        [ngClass]="getLevelClass(level)"
        [class.active]="levelFilter() === level"
        (click)="levelFilter.set(level)">
        {{ getLevelIcon(level) }} {{ level }}
        ({{ logLevelCounts()[level] || 0 }})
      </button>
    }
  </div>

  <!-- FILTERS -->
  <div class="filters">
    <input
      type="text"
      placeholder="üîç Search logs..."
      [value]="searchTerm()"
      (input)="onSearchInput($event)"
      class="search-input"
    />

    <select title='...' (change)="onLevelFilterChange($event)" [value]="levelFilter()">
      <option value="all">All Levels</option>
      @for (level of availableLevels(); track level) {
        <option [value]="level">{{ level }}</option>
      }
    </select>

    <select title='...' (change)="onTypeFilterChange($event)" [value]="typeFilter()">
      <option value="all">All Types</option>
      @for (type of availableTypes(); track type) {
        <option [value]="type">{{ type }}</option>
      }
    </select>

    <select title='...' (change)="onStatusFilterChange($event)" [value]="statusFilter()">
      <option value="all">All Status</option>
      @for (status of availableStatuses(); track status) {
        <option [value]="status">{{ status }}</option>
      }
    </select>

    <input
      type="number"
      min="10"
      max="1000"
      [value]="maxLogs()"
      (change)="onMaxLogsChange($event)"
      placeholder="Max logs"
      class="max-logs-input"
    />

    @if (isFiltering()) {
      <button (click)="clearFilters()" class="clear-filters">
        ‚úï Clear Filters
      </button>
    }
  </div>

  <!-- LOG LIST -->
  <div class="logs-container">
    @if (!hasLogs()) {
      <div class="empty-state">
        <div class="empty-icon">üì≠</div>
        <p>No logs yet. Start using the application to see logs here.</p>
      </div>
    } @else if (!hasFilteredLogs()) {
      <div class="empty-state">
        <div class="empty-icon">üîç</div>
        <p>No logs match your filters.</p>
        <button (click)="clearFilters()">Clear Filters</button>
      </div>
    } @else {
      <div class="logs-list">
        @for (log of filteredLogs(); track trackByLog($index, log)) {
          <div
            class="log-entry"
            [ngClass]="getLevelClass(log.log.level || '')"
            (click)="selectLog(log)">
            <div class="log-timestamp">
              {{ formatTimestamp(log['@timestamp']) }}
            </div>
            <div class="log-level">{{ getLevelIcon(log.log.level || '') }}</div>
            <div class="log-type">{{ getTypeIcon(log.log.type || '') }}</div>

            <div class="log-content">
              <div class="log-source">{{ log.log.source }}</div>
              <div class="log-message">
                {{ truncateMessage(log.log.message || '', 150) }}
              </div>

              @if (log.http) {
                <div class="log-http">
                  <span [ngClass]="getStatusClass(log.http.status_code)">
                    {{ log.http.status_code }}
                  </span>
                  <span>{{ log.http.method }}</span>
                  <span class="log-url">{{ log.http.url }}</span>
                  @if (log.http.duration_ms) {
                    <span class="log-duration">
                      {{ formatDuration(log.http.duration_ms) }}
                    </span>
                  }
                </div>
              }
            </div>

            <div class="log-trace">
              <div class="trace-id">
                trace: {{ log.trace.id.substring(0, 8) }}...
              </div>
              @if (log.trace.span?.id) {
                <div class="span-id">
                  span: {{ log.trace.span?.id?.substring(0, 8) }}...
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- LOG DETAILS MODAL -->
  @if (selectedLog()) {
    <div class="modal-overlay" (click)="closeLogDetails()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Log Details</h2>
          <button (click)="closeLogDetails()" class="modal-close">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="detail-actions">
            <button (click)="copyLogToClipboard(selectedLog()!)">
              üìã Copy JSON
            </button>
          </div>
          <pre class="log-json">{{ formatJSON(selectedLog()) }}</pre>
        </div>
      </div>
    </div>
  }
</div>
