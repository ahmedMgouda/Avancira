<div class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card border-0">
          <div class="card-header text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Active Sessions</h5>
            <button class="btn btn-sm btn-outline-danger"
                    [disabled]="selectedSessions.size === 0"
                    (click)="revokeSelected()">
              Revoke Selected
            </button>
          </div>
          <div class="card-body">
            <p *ngIf="loading" class="mb-0">Loading...</p>
            <ng-container *ngIf="!loading">
              <p *ngIf="deviceSessions.length === 0" class="text-muted mb-0">No active sessions.</p>
              <div class="device-list" *ngIf="deviceSessions.length > 0">
                <div class="device-card" *ngFor="let device of deviceSessions; trackBy: trackByDevice">
                  <div class="device-card__header">
                    <div class="device-card__details">
                      <h6 class="device-card__title">{{ device.deviceName || device.deviceId }}</h6>
                      <div class="device-card__meta">
                        <span *ngIf="device.operatingSystem">{{ device.operatingSystem }}</span>
                        <span *ngIf="device.userAgent">{{ device.userAgent }}</span>
                        <span *ngIf="device.country || device.city">
                          {{ device.city ? device.city + ', ' : '' }}{{ device.country || '' }}
                        </span>
                        <span>Last active: {{ formatDate(device.lastActivityUtc) }}</span>
                      </div>
                    </div>
                    <!-- <div class="form-check">
                      <input class="form-check-input" type="checkbox"
                             [checked]="isDeviceFullySelected(device)"
                             [indeterminate]="isDevicePartiallySelected(device)"
                             (change)="toggleDeviceSelection(device, $event.target.checked)">
                      <label class="form-check-label">Select all</label>
                    </div> -->
                  </div>
                  <div class="table-responsive">
                    <table class="table align-middle mb-0">
                      <thead>
                        <tr>
                          <th scope="col" class="w-auto"></th>
                          <th scope="col">IP Address</th>
                          <th scope="col">Created</th>
                          <th scope="col">Last Active</th>
                          <th scope="col">Expires</th>
                          <th scope="col" class="text-end">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let session of device.sessions; trackBy: trackBySession">
                          <!-- <td>
                            <input type="checkbox"
                                   class="form-check-input"
                                   [checked]="isSessionSelected(session.id)"
                                   (change)="onSelectSession(session.id, $event.target.checked)">
                          </td> -->
                          <td>
                            <div class="session-ip">{{ session.ipAddress }}</div>
                            <div class="session-agent text-muted" *ngIf="session.userAgent && session.userAgent !== device.userAgent">
                              {{ session.userAgent }}
                            </div>
                          </td>
                          <td>{{ formatDate(session.createdAtUtc) }}</td>
                          <td>{{ formatDate(session.lastActivityUtc) }}</td>
                          <td>{{ formatDate(session.absoluteExpiryUtc) }}</td>
                          <td class="text-end">
                            <button class="btn btn-sm btn-outline-danger"
                                    type="button"
                                    (click)="revoke(session)">
                              Revoke
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
