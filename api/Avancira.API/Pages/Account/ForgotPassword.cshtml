@page
@model Avancira.API.Pages.Account.ForgotPasswordModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Forgot Password";
    Layout = "../Shared/_AccountLayout";
}

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="account-form__alert">@Model.Message</div>
}

<form method="post" class="account-form">
    @Html.AntiForgeryToken()

    <div asp-validation-summary="ModelOnly" class="account-form__validation"></div>

    <div class="account-form__group">
        <label asp-for="Input.Email" class="account-form__label"></label>
        <input asp-for="Input.Email" type="email" class="account-form__input" autocomplete="email" />
        <span asp-validation-for="Input.Email" class="account-form__error"></span>
    </div>

    <div id="cooldown-message" class="account-form__notice" style="display:@(Model.RemainingCooldown > 0 ? "block" : "none")">
        Please wait <span id="cooldown-timer">@Model.RemainingCooldown</span> seconds before requesting another reset.
    </div>

    <button id="submitBtn" type="submit" class="account-form__submit" @(Model.RemainingCooldown > 0 ? "disabled" : string.Empty)>Send password reset link</button>
</form>

<p class="account-form__footer-text">
    Remembered your password?
    <a class="account-form__link" asp-page="/Account/Login">Back to login</a>
</p>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            var cooldown = @Model.RemainingCooldown;
            if (cooldown > 0) {
                var btn = document.getElementById('submitBtn');
                var message = document.getElementById('cooldown-message');
                var timer = document.getElementById('cooldown-timer');
                if (btn) btn.disabled = true;
                var interval = setInterval(function () {
                    cooldown--;
                    if (timer) timer.textContent = Math.max(cooldown, 0);
                    if (cooldown <= 0) {
                        clearInterval(interval);
                        if (message) message.style.display = 'none';
                        if (btn) btn.disabled = false;
                    }
                }, 1000);
            }
        })();
    </script>
}
