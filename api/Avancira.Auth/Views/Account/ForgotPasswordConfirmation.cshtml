@model ForgotPasswordConfirmationViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Check Your Email";
}

<div class="text-center mb-4">
    <i class="bi bi-envelope-check-fill text-success" style="font-size: 4rem;"></i>
    <h2 class="mt-3 mb-3">Check Your Email</h2>
</div>

@* Show email if available *@
@if (!string.IsNullOrEmpty(Model.Email))
{
    <div class="alert alert-success" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        We've sent a password reset link to <strong>@Model.Email</strong>
    </div>
}
else
{
    <div class="alert alert-info" role="alert">
        <i class="bi bi-info-circle-fill me-2"></i>
        If an account exists with that email address, we've sent a password reset link.
    </div>
}

@* Instructions *@
<div class="card mb-3">
    <div class="card-body">
        <h5 class="card-title">
            <i class="bi bi-list-check me-2"></i>Next Steps
        </h5>
        <ol class="mb-0">
            <li>Check your email inbox</li>
            <li>Click the reset link in the email</li>
            <li>Create a new password</li>
        </ol>
    </div>
</div>

@* Troubleshooting tips *@
<div class="card mb-3">
    <div class="card-body">
        <h6 class="card-title">
            <i class="bi bi-question-circle me-2"></i>Didn't receive the email?
        </h6>
        <ul class="mb-0 small">
            <li>Check your spam or junk folder</li>
            <li>Verify you entered the correct email address</li>
            <li>The link expires in 24 hours</li>
            <li>Wait a moment - emails can take a few minutes to arrive</li>
        </ul>
    </div>
</div>

@* Cooldown message for resend *@
<div id="cooldown-message" class="alert alert-warning d-none mb-3" role="alert">
    <i class="bi bi-clock-fill me-2"></i>
    You can request another reset in <strong><span id="cooldown-timer">@Model.RemainingCooldown</span></strong> seconds
</div>

@* Resend button (if email is available) *@
@if (!string.IsNullOrEmpty(Model.Email))
{
    <form asp-action="ForgotPassword" method="get" class="mb-3">
        <input type="hidden" name="email" value="@Model.Email" />
        <button id="resendBtn"
                type="submit"
                class="btn btn-outline-primary w-100"
                @(Model.RemainingCooldown > 0 ? "disabled" : "")>
            <i class="bi bi-arrow-clockwise me-2"></i>Resend Reset Link
        </button>
    </form>
}

<p class="text-center mt-3 mb-0">
    <a asp-action="Login" class="link-secondary">Back to login</a>
</p>

@section Scripts {
    <script>
        // Cooldown timer for resend functionality
        (function () {
            const cooldown = @Model.RemainingCooldown;
            const message = document.getElementById('cooldown-message');
            const timer = document.getElementById('cooldown-timer');
            const btn = document.getElementById('resendBtn');

            // Validate elements exist
            if (!message || !timer || !btn) {
                return; // No resend button available
            }

            // If cooldown is active, start countdown
            if (cooldown > 0) {
                message.classList.remove('d-none');
                btn.disabled = true;

                let remaining = cooldown;

                // Update timer every second
                const interval = setInterval(function () {
                    remaining--;
                    timer.textContent = remaining;

                    // When countdown completes, enable resend button
                    if (remaining <= 0) {
                        clearInterval(interval);
                        message.classList.add('d-none');
                        btn.disabled = false;
                    }
                }, 1000);
            }
        })();
    </script>
}